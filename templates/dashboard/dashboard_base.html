<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Dashboard{% endblock %}</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
    :root {
        --bg-main:#F7F7F7;
        --sidebar-bg:#FFFFFF;
        --primary:#007BFF;
        --text-dark:#212529;
        --border-color:#E3E6EA;
    }

    body{
        font-family:'Inter',sans-serif;
        background:var(--bg-main);
        color:var(--text-dark);
        overflow-x:hidden;
    }

    /* ================= Sidebar ================= */
    .sidebar{
        width:250px;
        height:100vh;
        background:var(--sidebar-bg);
        position:fixed;
        top:0; left:0;
        border-right:1px solid var(--border-color);
        display:flex;
        flex-direction:column;
        padding:1.2rem 1rem;
        transition:0.35s ease;
        z-index:1000;
    }

    .sidebar.hide{ left:-260px; } /* Desktop collapse */

    .sidebar .menu{
        flex:1;
        overflow-y:auto;
        padding-bottom:80px;
    }

    .sidebar a{
        display:flex;align-items:center;gap:10px;
        padding:10px 14px;margin-bottom:6px;
        border-radius:10px;text-decoration:none;
        color:var(--text-dark);font-weight:500;
        transition:.25s;
    }
    .sidebar a:hover, .sidebar a.active{ background:var(--primary);color:#fff; }

    .logout-box{ position:sticky; bottom:0; background:#fff; padding:10px 0; }
    .logout-btn{ width:100%; background:#E74C3C;border:none;color:#fff;border-radius:10px;padding:10px;font-weight:600;}
    .logout-btn:hover{ background:#c0392b; }

    /* ================= Main ================= */
    .main{
        margin-left:260px;
        padding:2.2rem;
        transition:0.35s ease;
    }
    .main.expand{ margin-left:0; } /* Desktop collapse →

    /* ========== Mobile ========== */
    @media(max-width:991px){
        .sidebar{ left:-260px; }
        .sidebar.open{ left:0; box-shadow:4px 0 15px rgba(0,0,0,.18); }
        .main{ margin-left:0 !important; }
    }

    .sidebar-toggle{
        position:fixed; left:15px; top:15px;
        z-index:1100;
        background:white;
        border-radius:6px;
        padding:6px 10px;
        display:block;
    }
</style>

</head>
<body>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">

    <div class="menu">
        <h3><i class="fa-solid fa-id-card-clip"></i> SmartCard</h3>

        <a href="{% url 'app_accounts:dashboard' %}"
           class="{% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
           <i class="fa-solid fa-house"></i> Dashboard
        </a>

        <a href="{% url 'app_accounts:profile_and_card' %}"
           class="{% if request.resolver_match.url_name == 'profile_and_card' %}active{% endif %}">
           <i class="fa-solid fa-id-badge"></i> Profile & Card
        </a>

        <a href="{% url 'app_contacts:contact_dashboard' %}"
           class="{% if request.resolver_match.url_name == 'contact_dashboard' %}active{% endif %}">
           <i class="fa-solid fa-address-book"></i> Contacts
        </a>

        <a href="{% url 'app_accounts:subscription' %}"
           class="{% if request.resolver_match.url_name == 'subscription' %}active{% endif %}">
           <i class="fa-solid fa-credit-card"></i> Subscription
        </a>

        <a href="{% url 'app_settings:settings_home' %}"
           class="{% if 'settings' in request.path %}active{% endif %}">
           <i class="fa-solid fa-gear"></i> Settings
        </a>
    </div>

    <!-- Logout bottom -->
    <div class="logout-box">
        <form method="post" action="{% url 'app_accounts:logout' %}">
            {% csrf_token %}
            <button class="logout-btn"><i class="fa-solid fa-right-from-bracket"></i> Logout</button>
        </form>
    </div>
</div>

<!-- Toggle -->
<button class="sidebar-toggle btn btn-light shadow-sm" id="toggleBtn">
    <i class="fa-solid fa-bars"></i>
</button>

<!-- main -->
<main class="main">{% block content %}{% endblock %}</main>

<!-- Toast -->
<div class="toast-container position-fixed top-0 end-0 p-3">
    {% for message in messages %}
    <div class="toast text-bg-{{ message.tags }} border-0 shadow-sm">
        <div class="d-flex"><div class="toast-body">{{ message }}</div>
            <button type="button" class="btn-close m-auto" data-bs-dismiss="toast"></button>
        </div>
    </div>
    {% endfor %}
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", ()=>{

    const sidebar = document.getElementById("sidebar");
    const toggle = document.getElementById("toggleBtn");
    const main = document.querySelector(".main");

    /* =========================
       Sidebar Toggle (Stable Fix)
    ==========================*/
    toggle.addEventListener("click", (e) => {
        e.stopPropagation();   // ⛔ toggle click যেন outside-listener না ধরে
        sidebar.classList.toggle("open");
        sidebar.classList.toggle("hide");
        main.classList.toggle("expand");
    });

    /* =============== Click Outside To Close (Mobile Only) ================= */
    document.addEventListener("click", (e) => {

        // only close when sidebar actually open
        if(sidebar.classList.contains("open") 
           && !sidebar.contains(e.target)
           && e.target !== toggle){
            sidebar.classList.remove("open");
            sidebar.classList.add("hide");
            main.classList.add("expand");
        }
    });

    /* Toast Auto Open */
    document.querySelectorAll('.toast')
        .forEach(t=> new bootstrap.Toast(t,{delay:3000}).show());
});
</script>


</body>
</html>
