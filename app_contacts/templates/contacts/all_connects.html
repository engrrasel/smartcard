{% extends "contacts/connects_base.html" %}
{% load static %}
{% block connect_content %}

<link rel="stylesheet" href="{% static 'app_contacts/css/all_contacts.css' %}">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="{% static 'app_contacts/js/my_contacts.js' %}" defer></script>


<h3 class="fw-bold mb-4 d-flex justify-content-between align-items-center">
    <span>üìá Saved Contacts</span>

    <input id="searchBox" type="text" class="form-control"
           placeholder="Search name / phone / email / address... üîç"
           style="max-width:280px;border-radius:6px;">
</h3>


{% if contacts %}
<div id="contactContainer" class="row">

{% for c in contacts %}
<div class="col-12 contact-row req-item"
     data-name="{{ c.visitor.full_name|default:c.visitor.username|lower }}"
     data-email="{{ c.visitor.email|lower }}"
     data-phone="{{ c.visitor.phone|default:'' }}"
     data-address="{{ c.visitor.address|default:''|lower }}"
     data-org="{{ c.visitor.organization|default:''|lower }}">

    <div class="contact-flat-card pointer"
         onclick="window.location='{% url 'app_contacts:my_connects_db' c.id %}'">

        <div class="d-flex align-items-center gap-3">
            <div class="avatar-box">
                <img src="{% if c.visitor.profile_picture %}{{ c.visitor.profile_picture.url }}{% else %}https://via.placeholder.com/70{% endif %}" 
                     class="flat-avatar">
                <span class="online-dot"></span>
            </div>

            <div class="contact-info">
                <h6>{{ c.visitor.full_name|default:c.visitor.username }}</h6>
                <small>{{ c.visitor.email }}</small><br>
                {% if c.visitor.phone %}
                    <small><i class="fa-solid fa-phone"></i> {{ c.visitor.phone }}</small>
                {% endif %}
            </div>
        </div>

        <div class="action-icons">

            {% if c.visitor.phone %}
            <button class="contact-btn call" onclick="event.stopPropagation();" data-phone="{{ c.visitor.phone }}">
                <i class="fa-solid fa-phone"></i>
            </button>
            {% endif %}

            <button class="contact-btn email" onclick="event.stopPropagation();" data-email="{{ c.visitor.email }}">
                <i class="fa-solid fa-envelope"></i>
            </button>

            <button class="contact-btn note" onclick="event.stopPropagation();" data-id="{{ c.id }}">
                <i class="fa-regular fa-note-sticky"></i>
            </button>

            <button class="contact-btn delete" onclick="event.stopPropagation();" data-id="{{ c.id }}">
                <i class="fa-solid fa-trash"></i>
            </button>

        </div>

    </div>
</div>
{% endfor %}

</div>

{% else %}
<div class="alert alert-warning text-center">No Contacts Found.</div>
{% endif %}

<!-- ‚≠ê NOTE MODAL (Final) -->
<div id="noteModal" class="modal-overlay">
    <div class="modal-box">
        <h4>‚úç Add Note</h4>

        <textarea id="newNote" class="form-control" rows="2"></textarea>
        <p id="lastNoteText" style="margin-top:10px;font-size:14px;color:#444"></p>

        <div class="d-flex justify-content-end gap-2 mt-3">
            <button onclick="closeNote()" class="btn btn-secondary">Close</button>
            <button id="saveNoteBtn" class="btn btn-primary">Save</button>
        </div>
    </div>
</div>

{% endblock %}
