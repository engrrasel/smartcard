{% extends "dashboard/dashboard_base.html" %}
{% load widget_tweaks %}

{% block content %}
<style>
#previewImage {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #ddd;
}
</style>

<h2 class="mb-3">Edit Profile</h2>

<form method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    
    <div class="row g-3">

        {% for field in form %}
            {% if field.name != 'profile_picture' %}
            <div class="col-md-6">
                <label class="form-label">{{ field.label }}</label>
                {{ field|add_class:"form-control" }}
            </div>
            {% endif %}
        {% endfor %}
        
        <!-- ✅ Profile Picture Upload -->
        <div class="col-md-6">
            <label class="form-label">Profile Picture</label>
            <input type="file" name="profile_picture" id="id_profile_picture" class="form-control">

            <!-- ✅ Profile Image Preview -->
            <img id="previewImage"
                 src="{% if user.userprofile.profile_picture %}{{ user.userprofile.profile_picture.url }}{% else %}https://via.placeholder.com/150{% endif %}"
                 class="mt-2"
                 alt="Preview">
        </div>

    </div>

    <div class="d-flex gap-2 mt-4">
        <button type="submit" class="btn btn-primary">Save Changes</button>

        {% if user.userprofile.profile_picture %}
        <a href="{% url 'remove_profile_picture' %}" class="btn btn-danger">Remove Picture</a>
        {% endif %}
    </div>

</form>

<script>
document.getElementById("id_profile_picture").addEventListener("change", function () {
    const file = this.files[0];
    if (file) {
        document.getElementById("previewImage").src = URL.createObjectURL(file);
    }
});
</script>

{% endblock %}
