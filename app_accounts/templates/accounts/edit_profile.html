{% extends "dashboard/dashboard_base.html" %}
{% load widget_tweaks %}

{% block content %}
<style>
#previewImage {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #ddd;
}
</style>

<!-- ✅ Message Block -->
{% if messages %}
<div class="container mt-3">
    {% for message in messages %}
        <div class="alert 
                    {% if message.tags == 'error' %}alert-danger
                    {% elif message.tags == 'warning' %}alert-warning
                    {% elif message.tags == 'success' %}alert-success
                    {% else %}alert-info{% endif %}">
            {{ message }}
        </div>
    {% endfor %}
</div>
{% endif %}

<h2 class="mb-3">Edit Profile</h2>

<form method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    
    <div class="row g-3">

        <!-- ✅ Username -->
        <div class="col-md-6">
            <label class="form-label">Username</label>
            {{ form.username|add_class:"form-control" }}
            {% if form.username.field.disabled %}
                <small class="text-muted">You can change your username only once.</small>
            {% else %}
                <small class="text-muted">Choose carefully — this can’t be changed later.</small>
            {% endif %}
        </div>

        <!-- ✅ Other fields -->
        {% for field in form %}
            {% if field.name != 'profile_picture' and field.name != 'username' %}
            <div class="col-md-6">
                <label class="form-label">{{ field.label }}</label>
                {{ field|add_class:"form-control" }}
            </div>
            {% endif %}
        {% endfor %}
        
        <!-- ✅ Profile Picture -->
        <div class="col-md-6">
            <label class="form-label">Profile Picture</label>
            <input type="file" name="profile_picture" id="id_profile_picture" class="form-control">

            <img id="previewImage"
                 src="{% if user.userprofile.profile_picture %}{{ user.userprofile.profile_picture.url }}{% else %}https://via.placeholder.com/150{% endif %}"
                 class="mt-2"
                 alt="Preview">
        </div>

    </div>

    <div class="d-flex gap-2 mt-4">
        <button type="submit" class="btn btn-primary">Save Changes</button>

        {% if user.userprofile.profile_picture %}
        <a href="{% url 'remove_profile_picture' %}" class="btn btn-danger">Remove Picture</a>
        {% endif %}
    </div>
</form>

<script>
document.getElementById("id_profile_picture").addEventListener("change", function () {
    const file = this.files[0];
    if (file) {
        document.getElementById("previewImage").src = URL.createObjectURL(file);
    }
});
</script>

{% endblock %}
