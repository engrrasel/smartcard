{% extends "base.html" %}
{% block content %}

<style>
body{background:#eef2ff;font-family:'Inter',sans-serif;}
.profile-card{max-width:600px;margin:3rem auto;background:#fff;border-radius:18px;padding-bottom:15px;
box-shadow:0 10px 25px rgba(0,0,0,.1);}
.cover{background:linear-gradient(120deg,#007bff,#00d2ff);height:160px;}
.avatar{width:120px;height:120px;border-radius:50%;border:5px solid #fff;margin-top:-60px;}
.btn-area{display:flex;gap:10px;justify-content:center;margin:20px 0;}
.btn-primary,.btn-call,.btn-save-contact{padding:9px 18px;color:#fff;border-radius:8px;font-weight:600;}
.btn-primary{background:#0d6efd;} .btn-call{background:#28a745;} .btn-save-contact{background:#6c63ff;}
</style>


<div class="profile-card text-center">

    <div class="cover"></div>
    <img class="avatar" src="{{ profile.profile_picture.url|default:'https://via.placeholder.com/120' }}">

    <h2>{{ profile.full_name }}</h2>
    <p>{{ profile.job_title }}</p>
    <p>{{ profile.company_name }}</p>

    <div class="btn-area">
        <a onclick="clickTrack('connect')" class="btn-primary"
           href="{% url 'app_contacts:add_contact' profile.id %}">Connect</a>

        {% if profile.phone %}
        <a onclick="clickTrack('call')" class="btn-call" href="tel:{{ profile.phone }}">Call</a>
        {% endif %}

        <a onclick="clickTrack('save')" class="btn-save-contact"
           href="{% url 'app_accounts:download_contact_vcard' profile.username %}">Save</a>
    </div>

</div>



<!-- ðŸ”¥ CLICK TRACK SCRIPT -->
<script>
function clickTrack(type){

    let payload = new URLSearchParams();
    payload.append("action", type);
    payload.append("csrfmiddlewaretoken", "{{ csrf_token }}");

    if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(
            pos => { payload.append("lat",pos.coords.latitude);payload.append("lon",pos.coords.longitude); send(payload); },
            ()=> send(payload)
        );
    } else send(payload);
}

function send(payload){
    fetch("{% url 'app_accounts:click_track' profile.username %}",{
        method:"POST",
        headers:{"Content-Type":"application/x-www-form-urlencoded"},
        body:payload
    }).then(r=>r.json()).then(d=>console.log("CLICK STORED âœ”",d));
}
</script>

{% endblock %}
