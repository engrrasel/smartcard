{% extends "dashboard/dashboard_base.html" %}
{% load static %}
{% block title %}{{ profile.full_name }} ‚Äî Dashboard{% endblock %}
{% block content %}

<link rel="stylesheet" href="{% static 'accounts/css/click_analytics.css' %}">
<script defer src="{% static 'accounts/js/click_track.js' %}"></script>

<div class="container py-4">

<h2 class="text-center fw-bold mb-4">üìä Button Click Analytics</h2>

<!-- ================= TOP ANALYTICS ================= -->
<div class="row text-center mb-4">

    <div class="col-6 col-md-3">
        <div class="click-box"><h1>{{ click_stats.total|default:0 }}</h1><small>Total Clicks</small></div>
    </div>

    <div class="col-6 col-md-3">
        <div class="click-box text-primary"><h1>{{ click_stats.connect|default:0 }}</h1><small>Connect</small></div>
    </div>

    <div class="col-6 col-md-3">
        <div class="click-box text-success"><h1>{{ click_stats.save|default:0 }}</h1><small>Saved</small></div>
    </div>

    <div class="col-6 col-md-3">
        <div class="click-box text-danger"><h1>{{ click_stats.call|default:0 }}</h1><small>Call</small></div>
    </div>

</div>


<!-- ================= BUTTON TAB SECTION ================= -->
<div class="d-flex justify-content-center gap-3 mb-4">
    <button class="btn btn-dark px-4" onclick="showTab('tab_clicks')">üì• Recent Click Logs</button>
    <button class="btn btn-primary px-4" onclick="showTab('tab_location')">üåç Visitor Locations</button>
</div>


<!-- ========================== RECENT CLICKS TAB ========================== -->
<div id="tab_clicks" class="tab-section" style="display:none;">
    <h4 class="text-center fw-bold mb-3">üì• Recent Click Logs (Last 50)</h4>

    <div class="log-box">
        <table class="table table-hover">
            <thead class="table-light">
                <tr>
                    <th>Button</th><th>IP</th><th>Device</th><th>Time</th>
                </tr>
            </thead>
            <tbody>
            {% for c in click_logs %}
            <tr>
                <td><span class="badge bg-primary">{{ c.button_type }}</span></td>
                <td>{{ c.device_ip }}</td>
                <td>{{ c.user_agent|truncatechars:22 }}</td>
                <td>{{ c.timestamp|date:"d M ‚Ä¢ h:i A" }}</td>
            </tr>
            {% empty %}
            <tr><td colspan=4 class="text-center text-muted py-3">No Click Data Found</td></tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>


<!-- ========================== VISITOR LOCATION TAB ========================== -->
<div id="tab_location" class="tab-section" style="display:none;">
    <h4 class="text-center fw-bold mb-3">üåç Visitor Location Logs</h4>

    <table class="table table-striped">
        <thead>
            <tr><th>Country</th><th>City</th><th>Lat</th><th>Lon</th><th>Time</th></tr>
        </thead>
        <tbody>
        {% for v in location_logs %}
        <tr>
            <td>{{ v.country|default:"-" }}</td>
            <td>{{ v.city|default:"-" }}</td>
            <td>{{ v.latitude|default:"-" }}</td>
            <td>{{ v.longitude|default:"-" }}</td>
            <td>{{ v.timestamp|date:"d M h:i A" }}</td>
        </tr>
        {% empty %}
        <tr><td colspan=5 class="text-center text-muted py-3">No Location Data</td></tr>
        {% endfor %}
        </tbody>
    </table>
</div>


<script>
function showTab(id){
    document.querySelectorAll(".tab-section").forEach(s=>s.style.display="none");
    document.getElementById(id).style.display="block";
}
</script>

</div>
{% endblock %}
